<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/tailwind.css" />
    <link rel="stylesheet" href="/css/icons.min.css" />
    <script src="/js/alpine.min.js" defer></script>
    <script src="/js/pocketbase.umd.js" defer></script>
    <title>Hotel</title>
  </head>
  <body class="p-5 block">
    <div class="max-w-[40rem] mx-auto" x-data="signin">
      <div>
        <h1 class="text-xl font-semibold pb-5 mb-5 border-b border-gray-300">
          Authentication
        </h1>
        <div class="grid grid-cols-2 gap-5">
          <div
            class="text-center bg-gray-100 rounded p-3 flex flex-col justify-center gap-3"
          >
            <div>
              <span class="text-2xl">ðŸ¤—</span> <br />Welcome to Admin System.
              Please Sign In to continue.
            </div>
          </div>
          <div class="flex flex-col gap-3">
            <span x-text="email"></span>
            <input
              type="text"
              placeholder="Email"
              class="input input-bordered w-full"
              x-model="email"
            />
            <input
              type="password"
              placeholder="Password"
              class="input input-bordered w-full"
              x-model="password"
            />
            <button class="btn btn-primary">Sign In</button>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    document.addEventListener("alpine:init", () => {
      Alpine.data("signin", () => ({
        email: "",
        password: "",
        showLogin: false,

        async init () {
            // initialize pocketbase
            this.client = new PocketBase('http://127.0.0.1:8090');

            // capture invalid token
            this.client.afterSend = function (response, data) {
              if (response.status === 401) {
                this.showLogin = true
              }

              return data
            }

            // if user is not logged in, show login / signup page
            if (!window.localStorage.getItem('pocketbase_auth')) {
              this.showLogin = true
              return
            }

            // resume session
            const auth = JSON.parse(window.localStorage.getItem('pocketbase_auth'))
            this.client.authStore.save(auth.token, auth.model)
          },
      }));
    });
  </script>
</html>
